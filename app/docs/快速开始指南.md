# å¿«é€Ÿå¼€å§‹æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å¿«é€Ÿå¯åŠ¨å¹¶æµ‹è¯•å¡å¯†æˆæƒç³»ç»Ÿã€‚

---

## ğŸ“‹ å‰ç½®æ¡ä»¶

1. **Python 3.9+** å·²å®‰è£…
2. **MySQL 5.7+** å·²å®‰è£…å¹¶è¿è¡Œ
3. **pip** åŒ…ç®¡ç†å™¨å·²å®‰è£…

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆ5æ­¥ï¼‰

### æ­¥éª¤ 1ï¼šå®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### æ­¥éª¤ 2ï¼šé…ç½®æ•°æ®åº“

ç¼–è¾‘ `.env.development` æ–‡ä»¶ï¼Œè®¾ç½®ä½ çš„æ•°æ®åº“ä¿¡æ¯ï¼š

```bash
DB_USER=root
DB_PASSWORD=your_password
DB_HOST=localhost
DB_PORT=3306
DB_NAME=login_km_system_dev
```

### æ­¥éª¤ 3ï¼šåˆ›å»ºæ•°æ®åº“

```bash
# è®¾ç½®å¼€å‘ç¯å¢ƒ
export ENV=dev

# åˆ›å»ºæ•°æ®åº“
python -m app.scripts.create_database
```

### æ­¥éª¤ 4ï¼šåº”ç”¨æ•°æ®åº“è¿ç§»

```bash
# åº”ç”¨è¿ç§»ï¼ˆåˆ›å»ºè¡¨ç»“æ„ï¼‰
alembic upgrade head
```

å¦‚æœ `alembic` å‘½ä»¤ä¸å¯ç”¨ï¼Œä½¿ç”¨ï¼š
```bash
python -m alembic upgrade head
```

### æ­¥éª¤ 5ï¼šåˆå§‹åŒ–ç³»ç»Ÿæ•°æ®

```bash
# åˆ›å»ºé»˜è®¤åº”ç”¨å’Œç®¡ç†å‘˜è´¦æˆ·
python -m app.scripts.init_data
```

æ‰§è¡ŒæˆåŠŸåä¼šçœ‹åˆ°ï¼š
```
====================================================
ç³»ç»Ÿæ•°æ®åˆå§‹åŒ–å®Œæˆï¼
====================================================

ğŸ“‹ è´¦æˆ·ä¿¡æ¯æ±‡æ€»ï¼š
------------------------------------------------------------
ç®¡ç†å‘˜è´¦æˆ·ï¼š
  ç”¨æˆ·å: admin
  å¯†ç : admin123456

æµ‹è¯•è´¦æˆ·ï¼š
  ç”¨æˆ·å: testuser
  å¯†ç : test123456

åº”ç”¨æ ‡è¯†ï¼š
  app_key: default_app
------------------------------------------------------------
```

---

## ğŸ¯ å¯åŠ¨æœåŠ¡

```bash
python run_app.py
```

æœåŠ¡å¯åŠ¨åï¼š
- API åœ°å€: http://localhost:8003
- Swagger æ–‡æ¡£: http://localhost:8003/docs
- ReDoc æ–‡æ¡£: http://localhost:8003/redoc

---

## ğŸ§ª å¿«é€Ÿæµ‹è¯•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Swagger UIï¼ˆæ¨èï¼‰

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:8003/docs

2. **æµ‹è¯•ç”¨æˆ·ç™»å½•**ï¼š
   - æ‰¾åˆ° `POST /api/v1/auth/login`
   - ç‚¹å‡» "Try it out"
   - è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š
     ```json
     {
       "username": "testuser",
       "password": "test123456",
       "app_key": "default_app",
       "device_id": "test-device-001"
     }
     ```
   - ç‚¹å‡» "Execute"
   - å¤åˆ¶è¿”å›çš„ `token`

3. **è®¾ç½®è®¤è¯Token**ï¼š
   - ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„ ğŸ”’ "Authorize" æŒ‰é’®
   - åœ¨å¼¹å‡ºçª—å£ä¸­è¾“å…¥: `Bearer <ä½ çš„token>`
   - ç‚¹å‡» "Authorize"
   - ç‚¹å‡» "Close"

4. **æµ‹è¯•éœ€è¦è®¤è¯çš„æ¥å£**ï¼š
   - æ‰¾åˆ° `GET /api/v1/auth/me`
   - ç‚¹å‡» "Try it out"
   - ç‚¹å‡» "Execute"
   - åº”è¯¥è¿”å›å½“å‰ç”¨æˆ·ä¿¡æ¯

### æ–¹æ³•äºŒï¼šä½¿ç”¨ curl å‘½ä»¤

#### 1. ç”¨æˆ·æ³¨å†Œ
```bash
curl -X POST "http://localhost:8003/api/v1/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "myuser",
    "password": "mypassword123"
  }'
```

#### 2. ç”¨æˆ·ç™»å½•
```bash
curl -X POST "http://localhost:8003/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "test123456",
    "app_key": "default_app",
    "device_id": "test-device-001"
  }'
```

ä¿å­˜è¿”å›çš„ `token`ï¼Œä¾‹å¦‚ï¼š
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user_status": "normal",
  "has_card": false,
  "username": "testuser",
  "role": "user"
}
```

#### 3. éªŒè¯Token
```bash
curl -X GET "http://localhost:8003/api/v1/auth/verify" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

#### 4. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
```bash
curl -X GET "http://localhost:8003/api/v1/auth/me" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

---

## ğŸ“š æ¥å£åˆ—è¡¨

### è®¤è¯æ¥å£ï¼ˆä¸éœ€è¦ç™»å½•ï¼‰
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/v1/auth/register` | ç”¨æˆ·æ³¨å†Œ |
| POST | `/api/v1/auth/login` | ç”¨æˆ·ç™»å½• |

### éœ€è¦ç™»å½•çš„æ¥å£
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/v1/auth/verify` | éªŒè¯Token |
| GET | `/api/v1/auth/me` | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ |
| POST | `/api/v1/auth/logout` | ç”¨æˆ·ç™»å‡º |

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“è¿æ¥å¤±è´¥
**é”™è¯¯**: `sqlalchemyæ•°æ®åº“è¿æ¥å¤±è´¥`

**è§£å†³**:
1. æ£€æŸ¥ MySQL æœåŠ¡æ˜¯å¦è¿è¡Œ
2. æ£€æŸ¥ `.env.development` ä¸­çš„æ•°æ®åº“é…ç½®
3. ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰æƒé™åˆ›å»ºæ•°æ®åº“

### Q2: alembic å‘½ä»¤æ‰¾ä¸åˆ°
**é”™è¯¯**: `command not found: alembic`

**è§£å†³**:
ä½¿ç”¨å®Œæ•´çš„ Python æ¨¡å—è°ƒç”¨ï¼š
```bash
python -m alembic upgrade head
```

### Q3: Token éªŒè¯å¤±è´¥
**é”™è¯¯**: `Tokenæ— æ•ˆ` æˆ– `Tokenå·²è¿‡æœŸ`

**è§£å†³**:
1. æ£€æŸ¥Tokenæ˜¯å¦æ­£ç¡®å¤åˆ¶ï¼ˆåŒ…æ‹¬å®Œæ•´å†…å®¹ï¼‰
2. æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº† `Bearer ` å‰ç¼€
3. Tokené»˜è®¤æœ‰æ•ˆæœŸ7å¤©ï¼Œè¿‡æœŸéœ€è¦é‡æ–°ç™»å½•

### Q4: å¯†ç éªŒè¯å¤±è´¥
**é”™è¯¯**: `ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯`

**è§£å†³**:
1. ç¡®è®¤å¯†ç è‡³å°‘6ä½
2. ç¡®è®¤ç”¨æˆ·åå­˜åœ¨
3. é»˜è®¤æµ‹è¯•è´¦æˆ·ï¼š`testuser` / `test123456`

### Q5: åº”ç”¨ä¸å­˜åœ¨
**é”™è¯¯**: `åº”ç”¨ä¸å­˜åœ¨`

**è§£å†³**:
1. ç¡®è®¤ä½¿ç”¨äº†æ­£ç¡®çš„ `app_key`
2. é»˜è®¤åº”ç”¨æ ‡è¯†æ˜¯ï¼š`default_app`
3. è¿è¡Œåˆå§‹åŒ–è„šæœ¬ï¼š`python -m app.scripts.init_data`

---

## ğŸ“ ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å·²ç»å®Œæˆäº†åŸºç¡€çš„è®¤è¯åŠŸèƒ½æµ‹è¯•ï¼Œå¯ä»¥ï¼š

1. **é˜…è¯»è®¾è®¡æ–‡æ¡£**: `app/docs/é€šç”¨å¡å¯†ä¸æˆæƒç³»ç»Ÿè®¾è®¡è¯´æ˜.md`
2. **æŸ¥çœ‹ä»»åŠ¡æ¸…å•**: `app/docs/é€šç”¨å¡å¯†ä¸æˆæƒç³»ç»Ÿä»»åŠ¡.md`
3. **ç­‰å¾…åç»­åŠŸèƒ½**:
   - å¡å¯†ç®¡ç†ï¼ˆç”Ÿæˆã€ç»‘å®šã€æŸ¥è¯¢ï¼‰
   - æƒé™æ ¡éªŒ
   - ç®¡ç†åå°

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶: `logs/app_YYYY-MM-DD.log`
2. æŸ¥çœ‹å®Œæ•´æ–‡æ¡£: `app/docs/` ç›®å½•
3. æ£€æŸ¥æ•°æ®åº“è¡¨ç»“æ„: ä½¿ç”¨ MySQL å®¢æˆ·ç«¯æŸ¥çœ‹

---

## ğŸ”’ å®‰å…¨æé†’

âš ï¸ **é‡è¦**: 
- é»˜è®¤å¯†ç ï¼ˆ`admin123456`, `test123456`ï¼‰ä»…ç”¨äºå¼€å‘æµ‹è¯•
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰ï¼ŒåŠ¡å¿…ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†ç 
- JWTå¯†é’¥ï¼ˆSECRET_KEYï¼‰ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²
- å»ºè®®å®šæœŸæ›´æ¢å¯†é’¥å’Œå¯†ç 

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰**

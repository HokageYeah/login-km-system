# 路由配置指南

本文档说明如何在系统中配置一级路由和二级路由。

## 一、一级路由配置

对于**没有子菜单**的一级路由，直接配置即可：

```typescript
// 示例：用户管理路由（无子路由）
import { type RouteRecordRaw } from "vue-router";

const routes: Array<RouteRecordRaw> = [
  {
    path: 'users',
    name: 'Users',
    component: () => import('@/views/user/index.vue'),
    meta: {
      title: '用户管理',
      icon: 'User',
      roles: ['admin'],
      sort: 2,
    }
  },
];

export default routes;
```

### 路由说明

- `path`: 路由路径，相对于父路由（这里是 `/`）
- `name`: 路由名称，必须唯一
- `component`: 页面组件（懒加载）
- `meta.title`: 菜单中显示的标题
- `meta.icon`: 菜单图标（Element Plus 图标名称）
- `meta.roles`: 权限角色数组，如 `['admin']` 表示仅管理员可见
- `meta.sort`: 菜单排序，数字越小越靠前

## 二、二级路由配置

对于**需要子菜单**的一级路由，需要使用 `RouterWrapper` 组件作为父组件：

```typescript
// 示例：仪表盘路由（有子路由）
import { type RouteRecordRaw } from "vue-router";
import RouterWrapper from '@/layouts/components/RouterWrapper.vue';

const routes: Array<RouteRecordRaw> = [
  {
    path: 'dashboard',
    component: RouterWrapper,  // 使用 RouterWrapper 作为父组件
    meta: {
      title: '仪表盘',
      icon: 'DataLine',
      roles: ['admin'],
      sort: 1,
    },
    children: [
      // 默认子路由（访问 /dashboard 时显示）
      {
        path: '',  // 空路径表示默认路由
        name: 'Dashboard',
        component: () => import('@/views/dashboard/index.vue'),
        meta: {
          title: '仪表盘首页',
          icon: 'DataLine',
          roles: ['admin'],
          hidden: true,  // 在菜单中隐藏，避免重复显示
        }
      },
      // 二级路由1
      {
        path: 'dashboard2',
        name: 'Dashboard2',
        component: () => import('@/views/dashboard/index2.vue'),
        meta: {
          title: '仪表盘2',
          icon: 'DataLine',
          roles: ['admin'],
        }
      },
      // 二级路由2
      {
        path: 'analytics',
        name: 'DashboardAnalytics',
        component: () => import('@/views/dashboard/analytics.vue'),
        meta: {
          title: '数据分析',
          icon: 'DataAnalysis',
          roles: ['admin'],
        }
      }
    ]
  },
];

export default routes;
```

### 二级路由关键点

1. **父路由必须使用 `RouterWrapper`**：它提供了 `<router-view>` 来渲染子路由
2. **默认子路由**：`path: ''` 表示访问父路径时显示此页面
3. **隐藏默认子路由菜单**：设置 `meta.hidden: true` 避免在左侧菜单中重复显示
4. **子路由路径**：子路由的完整路径会自动拼接，如 `/dashboard/dashboard2`

## 三、路由行为说明

### 一级路由行为

点击左侧菜单中的一级菜单项（如"用户管理"），直接跳转到配置的组件页面。

```
用户管理 (/users) → UserIndex.vue
```

### 二级路由行为

点击左侧菜单中的二级菜单项，会展开子菜单，点击子菜单项跳转到对应页面。

```
仪表盘 (展开)
  ├─ 仪表盘首页 (hidden，点击父级时访问)
  ├─ 仪表盘2 (/dashboard/dashboard2) → Dashboard2.vue
  └─ 数据分析 (/dashboard/analytics) → Analytics.vue
```

## 四、菜单生成规则

菜单由 `src/utils/menu.ts` 自动生成，规则如下：

1. **隐藏规则**：`meta.hidden: true` 的路由不显示在菜单中
2. **标题必填**：没有 `meta.title` 的路由不显示
3. **权限过滤**：根据 `meta.roles` 和用户角色过滤菜单项
4. **递归渲染**：自动处理多级嵌套

## 五、完整示例

### 示例1：仅一级路由的模块

```typescript
// src/router/modules/cards.ts
import { type RouteRecordRaw } from "vue-router";

const routes: Array<RouteRecordRaw> = [
  {
    path: 'cards',
    name: 'Cards',
    component: () => import('@/views/card/index.vue'),
    meta: {
      title: '卡密管理',
      icon: 'Ticket',
      roles: ['admin'],
      sort: 3,
    }
  },
];

export default routes;
```

### 示例2：一级+二级路由的模块

```typescript
// src/router/modules/system.ts
import { type RouteRecordRaw } from "vue-router";
import RouterWrapper from '@/layouts/components/RouterWrapper.vue';

const routes: Array<RouteRecordRaw> = [
  {
    path: 'system',
    component: RouterWrapper,
    meta: {
      title: '系统管理',
      icon: 'Setting',
      roles: ['admin'],
      sort: 99,
    },
    children: [
      {
        path: '',
        name: 'SystemSettings',
        component: () => import('@/views/system/settings.vue'),
        meta: {
          title: '系统设置',
          icon: 'Setting',
          roles: ['admin'],
          hidden: true,
        }
      },
      {
        path: 'logs',
        name: 'SystemLogs',
        component: () => import('@/views/system/logs.vue'),
        meta: {
          title: '操作日志',
          icon: 'Document',
          roles: ['admin'],
        }
      },
      {
        path: 'backup',
        name: 'SystemBackup',
        component: () => import('@/views/system/backup.vue'),
        meta: {
          title: '数据备份',
          icon: 'FolderOpened',
          roles: ['admin'],
        }
      }
    ]
  },
];

export default routes;
```

## 六、注意事项

1. **RouterWrapper 导入**：需要在路由模块中导入 `RouterWrapper`
2. **路由名称唯一**：所有路由的 `name` 必须在全局唯一
3. **默认路由隐藏**：建议将 `path: ''` 的默认子路由设置 `hidden: true`
4. **页面组件无需修改**：页面组件（`.vue` 文件）不需要添加 `<router-view>`，保持原样即可

## 七、新增路由流程

### 添加一级路由

1. 在 `src/router/modules/` 下创建新的路由文件（如 `example.ts`）
2. 配置路由（参考示例1）
3. 创建对应的页面组件（如 `src/views/example/index.vue`）
4. 系统会自动加载并生成菜单

### 添加二级路由

1. 在 `src/router/modules/` 下创建新的路由文件（如 `example.ts`）
2. 配置路由，使用 `RouterWrapper`（参考示例2）
3. 创建父路由对应的默认页面和子路由页面
4. 系统会自动加载并生成带子菜单的菜单项

## 八、技术实现原理

### RouterWrapper 组件

位置：`src/layouts/components/RouterWrapper.vue`

```vue
<template>
  <router-view v-slot="{ Component, route }">
    <transition name="fade-transform" mode="out-in">
      <component :is="Component" :key="route.path" />
    </transition>
  </router-view>
</template>
```

作用：为有子路由的一级路由提供 `<router-view>` 渲染容器，同时保持页面切换动画效果。

### 菜单生成逻辑

位置：`src/utils/menu.ts`

- 自动扫描路由配置
- 根据用户角色过滤
- 递归生成嵌套菜单结构
- 支持 `hidden` 属性隐藏菜单项

### 路由自动加载

位置：`src/router/index.ts`

使用 Vite 的 `import.meta.glob` 自动加载 `modules/` 目录下的所有路由文件，无需手动注册。

---

以上就是路由配置的完整指南。如有疑问，请参考 `src/router/modules/dashboard.ts` 的实现。
